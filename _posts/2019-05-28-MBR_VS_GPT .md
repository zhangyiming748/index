---
layout:     post                    # 使用的布局(不需要改)
title:      MBR和GPT硬盘分区表的那些事儿                 # 标题
subtitle:   为报倾城随太守,三百年,九芝堂  #副标题
date:       2019-05-28              # 时间
author:     Zen                      # 作者
header-img: img/pet/supremelysab-787607-unsplash.webp   #这篇文章标题背景图片
catalog: False                       # 是否归档
tags:                               #标签
    - 常识
---

 从Intel 6系列主板之后,就开始提供UEFI BIOS支持,正式支持GPT硬盘分区表,一举取代了此前的MBR分区表格式,不过为了保持对老平台的兼容,微软即使最新的Windows10系统也继续提供了对MBR分区表格式的支持.

 ----

### MBR和GPT分区表详解

全新硬盘(未初始化)装系统之前,必须对齐进行分区,硬盘分区初始化的格式(分区表)包括MBR和GPT两种.当然对于基于PowerPC的Mac电脑还有专门的Apple分区图,在这里就不做介绍.

**MBR** 的全称是Master Boot Record(主引导记录),MBR早在1983年IBM PC DOS 2.0中就已经提出.之所以叫"主引导记录",是因为它是存在于驱动器开始部分的一个特殊的启动扇区.这个扇区包含了已安装的操作系统的启动加载器和驱动器的逻辑分区信息.

主引导扇区是硬盘的第一扇区.它由三个部分组成,主引导记录MBR\硬盘分区表DPT和硬盘有效标志.在总共512字节的主引导扇区里MBR占446个字节,偏移地址0000H--0088H),它负责从活动分区中装载,并运行系统引导程序;第二部分是Partition table区(DPT分区表),占64个字节;第三部分是Magic number,占2个字节.

所谓启动加载器,是一小段代码,用于加载驱动器上其他分区上更大的加载器.如果你安装了Windows,Windows启动加载器的初始信息就放在这个区域里——如果MBR的信息被覆盖导致Windows不能启动,你就需要使用Windows的MBR修复功能来使其恢复正常.如果你安装了Linux,则位于MBR里的通常会是GRUB加载器.

DPT分区表偏移地址为01BEH--01FDH,每个分区表项长16个字节,共64字节为分区项1\分区项2\分区项3\分区项4,分别对应MBR的四个主分区.

Magic number也就是结束标志字,偏移地址01FE--01FF的2个字节,固定为55AA,如果该标志错误系统就不能启动.

MBR最大支持2.2TB磁盘,它无法处理大于2.2TB容量的磁盘.MBR还只支持最多4个主分区——如果你想要更多分区,你需要创建所谓"扩展分区",并在其中创建逻辑分区.

**GPT** 的全称是Globally Unique Identifier Partition Table,意即GUID分区表,它的推出是和UEFI BIOS相辅相成的,鉴于MBR的磁盘容量和分区数量已经不能满足硬件发展的需求,GPT首要的任务就是突破了2.2T分区的限制,最大支持18EB的分区.
而在分区数量上,GPT会为每一个分区分配一个全局唯一的标识符,理论上GPT支持无限个磁盘分区,不过在Windows系统上由于系统的限制,最多只能支持128个磁盘分区,基本可以满足所有用户的存储需求.在每一个分区上,这个标识符是一个随机生成的字符串,可以保证为地球上的每一个GPT分区都分配完全唯一的标识符.

而在安全性方面,GPT分区表也进行了全方位改进.在早期的MBR磁盘上,分区和启动信息是保存在一起的.如果这部分数据被覆盖或破坏,事情就麻烦了.相对的,GPT在整个磁盘上保存多个这部分信息的副本,因此它更为健壮,并可以恢复被破坏的这部分信息.GPT还为这些信息保存了循环冗余校验码(CRC)以保证其完整和正确——如果数据被破坏,GPT会发觉这些破坏,并从磁盘上的其他地方进行恢复.

小结:所以对于新平台用户(Intel 6系以后/AMD 900系列以后和A系列)来说,都强烈推荐使用GPT分区表格式,目前包括Windows Vista\7\8\8.1\10已经都支持读取和使用GPT分区表.而对于使用Windows 8\8.1\10的用户,换用GPT后开机启动速度也可以进一步得到显著提升.

### UEFI BIOS详解

UEFI的全称是Unified Extensible Firmware Interface,意即统一可扩展固件接口,它是基于EFI 1.10标准为基础发展而来,值得注意的是在UEFI正式确立之前,Intel就开始积极推进传统BIOS的升级方案,并最终确立了过渡方案EFI标准,直到2007年Intel将EFI标准的改进与完善工作交给Unified EFI Form进行全权负责,EFI标准则正式更名为UEFI.

### 相比传统BIOS,UEFI最大的几个区别在于:

1. 编码99%都是由C语言完成;

2. 一改之前的中断\硬件端口操作的方法,而采用了Driver/protocol的新方式;

3. 将不支持X86实模式,而直接采用Flat mode(也就是不能用DOS了,现在有些 EFI 或 UEFI 能用是因为做了兼容,但实际上这部分不属于UEFI的定义了);

4. 输出也不再是单纯的二进制code,改为Removable Binary Drivers;

5. OS启动不再是调用Int19,而是直接利用protocol/device Path;

6. 对于第三方的开发,前者基本上做不到,除非参与BIOS的设计,但是还要受到ROM的大小限制,而后者就便利多了.

7. 弥补BIOS对新硬件的支持不足的问题.

### 总结

UEFI和GPT是相辅相成的,二者缺一不可,要想使用GPT分区表则必须是UEFI BIOS环境.UEFI于用户而言最典型的特征就是使用了图形化界面,虽然还未达到操作系统界面的图形交互功能,但人性化的界面\鼠标的操作,已经将BIOS变得非常易用,对于不少电脑初级用户来说也可以很好的查看和设置BIOS的相关选项和功能.
