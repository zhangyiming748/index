---
layout:     post                    # 使用的布局(不需要改)
title:     TCP协议-如何保证传输可靠性            # 标题
subtitle:   我是一只被禁足的安小鸟 #副标题
date:       2021-03-25  00:00:01 GMT+0800             # 时间
author:     Zen                 # 作者
header-img: img/photo/birdAngle.webp    #这篇文章标题背景图片
catalog: True                # 是否归档
tags:                               #标签
    - 网络原理
---

>TCP协议传输的特点主要就是面向字节流\传输可靠\面向连接.这篇博客,我们就重点讨论一下TCP协议如何确保传输的可靠性的

# 确保传输可靠性的方式
+ 校验和
+ 序列号
+ 确认应答
+ 超时重传
+ 连接管理
+ 流量控制
+ 拥塞控制

### 校验和
[![6OZPEt.png](https://z3.ax1x.com/2021/03/25/6OZPEt.png)](https://imgtu.com/i/6OZPEt)
如果接收方比对校验和与发送方不一致,那么数据一定传输有误.但是如果接收方比对校验和与发送方一致,数据不一定传输成功
### 序列号和确认应答
TCP传输时将每个字节的数据都进行了编号,这就是序列号
TCP传输的过程中,每次接收方收到数据后,都会对传输方进行确认应答.也就是发送ACK报文.这个ACK报文当中带有对应的确认序列号,告诉发送方,接收到了哪些数据,下一次的数据从哪里发.
[![6OZG2F.png](https://z3.ax1x.com/2021/03/25/6OZG2F.png)](https://imgtu.com/i/6OZG2F)
16位的窗口大小最大能表示65535个字节(64K),但是TCP的窗口大小最大并不是64K.在TCP首部中40个字节的选项中还包含了一个窗口扩大因子M,实际的窗口大小就是16为窗口字段的值左移M位.每移一位,扩大两倍.
### 拥塞控制
TCP传输的过程中,发送端开始发送数据的时候,如果刚开始就发送大量的数据,那么就可能造成一些问题.网络可能在开始的时候就很拥堵,如果给网络中在扔出大量数据,那么这个拥堵就会加剧.拥堵的加剧就会产生大量的丢包,就对大量的超时重传,严重影响传输.

所以TCP引入了慢启动的机制,在开始发送数据时,先发送少量的数据探路.探清当前的网络状态如何,再决定多大的速度进行传输.这时候就引入一个叫做拥塞窗口的概念.发送刚开始定义拥塞窗口为 1,每次收到ACK应答,拥塞窗口加 1.在发送数据之前,首先将拥塞窗口与接收端反馈的窗口大小比对,取较小的值作为实际发送的窗口.

拥塞窗口的增长是指数级别的.慢启动的机制只是说明在开始的时候发送的少,发送的慢,但是增长的速度是非常快的.为了控制拥塞窗口的增长,不能使拥塞窗口单纯的加倍,设置一个拥塞窗口的阈值,当拥塞窗口大小超过阈值时,不能再按照指数来增长,而是线性的增长.在慢启动开始的时候,慢启动的阈值等于窗口的最大值,一旦造成网络拥塞,发生超时重传时,慢启动的阈值会为原来的一半(这里的原来指的是发生网络拥塞时拥塞窗口的大小),同时拥塞窗口重置为 1.
[![6OmKhV.png](https://z3.ax1x.com/2021/03/25/6OmKhV.png)](https://imgtu.com/i/6OmKhV)
拥塞控制是TCP在传输时尽可能快的将数据传输,并且避免拥塞造成的一系列问题.是可靠性的保证,同时也是维护了传输的高效性.
